План занятия:
- RPC
- Реализация RPC в Go
- Применение RPC
- Тестирование RPC
- Protobuf
- gRPC
___
<h5>RPC</h5>
RPC (remote protocol call) — удалённый вызов процедур, технология, позволяющая вызывать функции в другом процессе.

Вызываемый процесс (сервер) может выполняться на другой машине в сети или же на том же устройстве, что и вызывающий процесс (клиент).

RPC является именно технологией, а не протоколом. Практические реализации могут использовать различные протоколы сетевого взаимодействия: TCP, UDP, HTTP.

Сервер RPC является обыкновенной сетевой службой, работающей по принципу запрос-ответ. Инициатором взаимодействия всегда является клиент.

RPC-вызов обычно блокирующий (синхронный вызов), однако возможен и асинхронный режим взаимодействия.

> [!NOTE] Шарада: почему прикладные протоколы обёртывают в HTTP?
> Почему в прикладной протокол HTTP оборачивают некоторые другие прикладные протоколы, а не строят их на основе чистого TCP?
> 
> HTTP — firewall friendly. Если у нас большая организация, открытие доступа для каких-то нестандартных протоколов может быть проблемой.

Клиент RPC состоит из следующих компонентов:
- "Заглушка" (stub) — механизм упаковки параметров вызываемой функции и распаковки ответа сервера. Используется для сериализации аргументов вызываемой функции и десериализации ответа сервера.
- Клиент сетевой службы. Используется для передачи сообщений.

Сервер RPC состоит из следующих компонентов:
- "Заглушка" — то же назначение, что и на клиенте.
- Сервер сетевой службы. Используется для обработки запросов клиента и передачи сообщений.

Грубо говоря, заглушки — сериализаторы и десериализаторы. 

Клиентская заглушка называется заглушкой, потому что в ней содержатся объявления функций, но без непосредственной логики, чтобы в своём коде мы могли вызывать функцию, но по факту при этом произойдёт сетевой вызов к серверу (т.е. непосредственно логики там нет).

Вызов функции — отправка сообщения, содержащего имя вызываемой функции и аргументы вызова.

Принцип работы:
1. Клиент вызывает локальную функцию-заглушку и передаёт аргументы вызова.
2. Заглушка клиента сериализует аргументы функции и отправляет сообщение серверу, содержащее имя вызываемой функции.
3. Заглушка сервера десериализует сообщение.
4. Сервер выполняет функцию, выполняет результат и отправляет сообщение клиенту.
5. Клиент десериализует ответ.

![[Pasted image 20240727225118.png]]

Поскольку технология RPC не привязана к конкретным протоколам или методам сериализации данных, то существует несколько популярных реализаций. Не существует единой общепринятой реализации RPC, совместимой со всеми языками программирования.

Google RPC (gRPC) является попыткой создания универсальной реализации за счёт использования единого формата сериализации и разработки клиентов для разных языков программирования.

В Go существует реализация RPC поверх HTTP и TCP, для сериализации используется GOB, JSON или что-то иное.
___
<h5>Реализация RPC в Go</h5>
