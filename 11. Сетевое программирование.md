План занятия:
- Сетевое программирование
- Программирование на транспортном уровне
- Пакет "net"
- Тестирование сетевой службы
___
<h5>Сетевое программирование</h5>
Литература: "Network Programming with Go", Jan Newmarch
<h6>Abstract</h6>
Сети и их организация не меняются десятилетиями. Сетевое взаимодействие по большей части унифицировано, хотя существует множество стандартов и протоколов.

Почти все современные информационные системы подразумевают взаимодействие по сети. Как между пользователями и системой, так и между частями системы.
Go создавался для разработки крупных, а, следовательно, и распределённых сетевых приложений.
Даже если приложение не является распределённым, скорее всего оно предоставляет информацию по сети своим пользователям.
<h6>Уровни протоколов</h6>
Взаимодействие по сети происходит в соответствии с некоторой иерархической моделью, состоящей из уровней. Отправляемая и получаемая нами информация проходит по уровням этой модели, трансформируясь в формат, удобный для физической передачи (по кабелю).

Таким образом, информация на передающем устройстве проходит трансформацию (упаковку, кодирование) по уровням сверху вниз. На принимающем узле происходит обратная трансформация — информация декодируется в соответствии с той же моделью, снизу вверх.

Каждому уровню модели соответствуют свои протоколы. Конкретная реализация модели использует один или несколько протоколов на каждом уровне.

Протокол — это формальное соглашение о формате и других характеристиках процесса сетевого взаимодействия.

Наиболее известными являются модель OSI (open systems interconnection теоретическая) и модель TCP/IP (практическая).
<h6>Модель OSI</h6>
https://ru.wikipedia.org/wiki/Сетевая_модель_OSI
Модель OSI является эталонной теоретической моделью и на практике в полном объёме не реализуется.

| Модель OSI            | Функции                                                  | Протоколы                                               |
| --------------------- | -------------------------------------------------------- | ------------------------------------------------------- |
| Уровень приложений    | Доступ к сетевым службам                                 | HTTP, FTP, SMTP                                         |
| Уровень представления | Представление и шифрование данных                        | ASCII, EBCDIC, JPEG                                     |
| Сеансовый уровень     | Управление сеансом связи                                 | RPC, RAP                                                |
| Транспортный уровень  | Прямая связь между конечными пунктами и надёжность       | TCP, UDP, SCTP                                          |
| Сетевой уровень       | Определение маршрута и логическая адресация              | IPv4, IPv6, IPsec, AppleTalk                            |
| Канальный уровень     | Управление доступом к среде. Физическая адресация        | PPP, IEEE, 802.2, Ethernet, DSL, L2TP, ARP              |
| Физический уровень    | Работа со средой передачи, сигналами и двоичными данными | USB, витая пара, коаксиальный кабель, оптический кабель |

Сети по своей организации и логике работы довольно сильно похожи на обыкновенную почту :)
Мы заказываем баночку с вареньем:
1. Отправитель берёт баночку с вареньем, заворачивает её в пакетик;
2. Приезжает курьер, упаковывает пакетик в стандартную коробку;
3. Курьер отвозит коробку на почту, на почте её оборачивают пупырчатой плёнкой, обогащают информацией об адресе получателя, и передают для физической транспортировки;
4. Когда посылка приезжает в конечное отделение почты, запускается обратный процесс.
<h6>Модель TCP/IP</h6>
https://ru.wikipedia.org/wiki/TCP/IP
На практике, чаще используется модель TCP/IP, содержащая 4 уровня. В этой модели:
- уровень представления и приложений объединены в уровень приложений
- транспортный и сеансовый уровни из OSI объединены в транспортный уровень
- сетевой уровень из OSI остался сетевым
- физический и канальный уровни из OSI объединены в уровень сетевого доступа


| Стек протоколов TCP/IP   | Функции                                                                       | Протоколы                                                                                                                          |
| ------------------------ | ----------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------- |
| Уровень приложений       | Работа большинства сетевых приложений                                         | HTTP, RTSP, FTP, DNS                                                                                                               |
| Транспортный уровень     | Прямая связь между конечными пунктами и надёжность                            | TCP, UDP, SCTP, DCCP                                                                                                               |
| Межсетевой уровень       | Определение маршрута и логическая адресация                                   | IPv4, IPv6, ICMPv4, ICMPv6                                                                                                         |
| Уровень сетевого доступа | Физическая адресация. Работа со средой передачи, сигналами, двоичными данными | Ethernet, IEEE 802.11, Wireless Ethernet, SLIP, Token Ring, ATM и MPLS, физическая среда и принципы кодирования информации, T1, E1 |

Для нас, как разработчиков, имеет значение только транспортный уровень и уровень приложений, поскольку мы не работаем на других уровнях (в рамках прикладного программирования), хотя точно стоит иметь знания о том, как работают и остальные уровни.

Транспортный уровень отвечает за передачу данных и работает по протоколам TCP, UDP.
Протокол уровня приложений является специфическим для каждого типа приложений, поэтому работа на уровне приложений отличается для каждого конкретного приложения.

Go предоставляет готовые инструменты для сетевого взаимодействия приложений по протоколам TCP и UDP на уровне транспорта, и HTTP и RPC на уровне приложений.

Сторонние пакеты добавляют поддержку большинства популярных протоколов.

Сегодня будет речь идти именно о транспортном уровне.
<h6>Типы сетевого взаимодействия</h6>
Характер сетевого взаимодействия может быть различным.
Выделяют следующие категории:
- По способу взаимодействия: обмен сообщениями или удалённый вызов процедур (RPC)
- По типу соединений: синхронное, асинхронное, потоковое соединение и взаимодействие типа pub/sub

Информационная система, части которой взаимодействуют по сети, называют распределённой.

<h5>Программирование на транспортном уровне</h5>
Программирование на транспортном уровне подразумевает работу с протоколами TCP и UDP.
При этом обычно на сетевом уровне используется протокол IP. Адрес службы в сети на сетевом уровне определяется IP-адресом, а на транспортном — номером TCP/UDP порта.

Таким образом полный адрес службы имеет вид `ip:port` (комбинация IP и порта клиента и IP и порта сервера называется **сокетом**), например: `192.168.0.20:5544`.

Порты до 1024 считаются зарезервированными: https://ru.wikipedia.org/wiki/Список_портов_TCP_и_UDP
Также важно понимать, на каком IP-адресе будет работать сетевая служба; универсальным решением является 0.0.0.0 (это означает "слушать на всех сетевых интерфейсах").

Таким образом, IP-адрес характеризует компьютер в системе (т.е. целую систему), а порт — конкретную сетевую службу (приложение), запущенную на этом компьютере и зарегистрированную на этом компьютере.

**TCP:**
- устанавливает и поддерживает соединение между клиентом и сервером
- используется потоковая передача (нет концепции сообщений)
- гарантируется доставка пакетов с данными (целостность и порядок)
Устанавливается два канала, от клиента к серверу и от сервера к клиенту.

**UDP:**
- не используются соединения
- нет гарантии доставки пакетов

UDP быстрее, чем TCP, однако он не гарантирует доставку. Поэтому, UDP стоит использовать там, где скорость приоритетнее надёжности (например, видео-звонки).
___
<h5>Пакет "net"</h5>
https://pkg.go.dev/net
Пакет "net" предоставляет инструменты для создания сетевых клиентов и серверов, включая взаимодействие по протоколам IP/TCP/UDP, разрешение имён по протоколу DNS, использование сокетов ОС.

Основные инструменты пакета:
- Функция `Dial()` для подключения к сетевой службе,
- Функции `Listen()` и `Accept()` для регистрации сетевой службы и приёма подключений,
- Интерфейс `Listener` для управления соединением (приём, закрытие),
- Интерфейс `Conn` для чтения и записи сообщений посредством соединения.